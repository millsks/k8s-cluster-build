[sssd]
config_file_version = 2
services = nss, pam
domains = cluster.home.arpa

# Optional: enable debug if needed
# debug_level = 3

[domain/cluster.home.arpa]
# Basic domain / Kerberos
id_provider = ad
ad_domain = cluster.home.arpa
krb5_realm = CLUSTER.HOME.ARPA
# If your DC is the Synology NAS, you can pin it (optional)
# ad_server = ymir.cluster.home.arpa

# Cache credentials so users can still log in briefly if DC is unavailable
cache_credentials = True

# Use AD for both ID and auth
access_provider = simple

# Home directories: use NAS-backed NFS mount
fallback_homedir = /mnt/homes/%u
default_shell = /bin/bash

# Name formats
# Use plain 'username' style, not 'username@domain' everywhere
use_fully_qualified_names = False

# Case-insensitive logins (optional)
# case_sensitive = False

# How long to cache identities (seconds)
entry_cache_timeout = 600

# Optional: Restrict which users/groups can log in
# Allow only specific AD users:
# simple_allow_users = millsks anotheruser

# Or, allow only an AD group (preferred):
# simple_allow_groups = k8s-admins k8s-users

# Uncomment this if AD homeDirectory attribute is set and you want to respect it:
# override_homedir = /mnt/homes/%u

# Performance / enumeration
enumerate = False

# Fallback UID/GID ranges (not usually needed with AD, but harmless)
ldap_id_mapping = True
min_id = 1000
max_id = 2000000000